<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Upload file cepat dan aman menggunakan YUDZ Uploader." />
<title>YUDZ UPLOADER</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  :root {
    --bg-color: #0d1117;
    --surface-color: #161b22;
    --surface-secondary: #21262d;
    --surface-tertiary: #30363d;
    --primary-color: #388bfd;
    --primary-hover: #58a6ff;
    --text-color: #c9d1d9;
    --text-secondary: #8b949e;
    --text-tertiary: #6e7681;
    --error-color: #f85149;
    --success-color: #3fb950;
    --warning-color: #d29922;
    --border-color: #30363d;
    --shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    line-height: 1.6;
  }

  #particle-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.2;
  }

  .app-container {
    width: 100%;
    max-width: 1200px;
    display: flex;
    gap: 2rem;
    padding: 2rem;
    animation: fadeIn 0.5s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .main-content {
    flex: 1;
    max-width: 600px;
  }

  .sidebar {
    width: 300px;
    display: none;
    animation: slideIn 0.5s ease-out;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .container {
    background-color: var(--surface-color);
    padding: 2.5rem;
    border-radius: 16px;
    box-shadow: var(--shadow);
    width: 100%;
    border: 1px solid var(--border-color);
    transition: var(--transition);
  }

  .container:hover {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
  }

  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .logo i {
    font-size: 2rem;
    color: var(--primary-color);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  h2 {
    font-weight: 700;
    color: var(--text-color);
    font-size: 1.8rem;
    letter-spacing: -0.02em;
  }

  .subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
    margin-bottom: 2rem;
    font-weight: 400;
  }

  .tabs {
    display: flex;
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
    position: relative;
  }

  .tab {
    padding: 1rem 1.5rem;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-weight: 500;
    transition: var(--transition);
    position: relative;
  }

  .tab.active {
    color: var(--text-color);
    border-bottom-color: var(--primary-color);
  }

  .tab:hover {
    color: var(--text-color);
  }

  .tab-content {
    display: none;
    animation: fadeInContent 0.3s ease-out;
  }

  @keyframes fadeInContent {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .tab-content.active {
    display: block;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 1.75rem;
  }

  .input-group {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  label {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  input[type="text"] {
    width: 100%;
    padding: 0.875rem 1.25rem;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background-color: var(--surface-secondary);
    color: var(--text-color);
    font-size: 0.95rem;
    transition: var(--transition);
    font-family: 'Inter', sans-serif;
  }

  input[type="text"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(56, 139, 253, 0.15);
    transform: translateY(-2px);
  }

  .api-info {
    background-color: rgba(56, 139, 253, 0.1);
    border: 1px solid rgba(56, 139, 253, 0.2);
    border-radius: 8px;
    padding: 1rem;
    font-size: 0.9rem;
    margin-top: -0.5rem;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    transition: var(--transition);
  }

  .api-info:hover {
    background-color: rgba(56, 139, 253, 0.15);
  }

  .api-info i {
    color: var(--primary-color);
    margin-top: 0.1rem;
    font-size: 1.1rem;
  }

  .api-info a {
    color: var(--primary-color);
    font-weight: 500;
    text-decoration: none;
    transition: var(--transition);
  }

  .api-info a:hover {
    text-decoration: underline;
  }

  .version-selector {
    display: flex;
    gap: 1rem;
  }

  .version-selector input[type="radio"] {
    display: none;
  }

  .version-selector label {
    flex: 1;
    padding: 1rem;
    text-align: center;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
    background-color: var(--surface-secondary);
    font-weight: 500;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .version-selector label i {
    font-size: 1.2rem;
    color: var(--text-secondary);
  }

  .version-selector label:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
  }

  .version-selector input[type="radio"]:checked + label {
    border-color: var(--primary-color);
    background-color: rgba(56, 139, 253, 0.1);
    color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(56, 139, 253, 0.1);
  }

  .version-selector input[type="radio"]:checked + label i {
    color: var(--primary-color);
  }

  #dropArea {
    border: 2px dashed var(--border-color);
    border-radius: 12px;
    padding: 2.5rem;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    background-color: var(--surface-secondary);
    position: relative;
    overflow: hidden;
  }

  #dropArea::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, rgba(56, 139, 253, 0.05) 0%, transparent 70%);
    opacity: 0;
    transition: var(--transition);
  }

  #dropArea:hover, #dropArea.dragover {
    border-color: var(--primary-color);
    background-color: rgba(56, 139, 253, 0.05);
    transform: translateY(-3px);
  }

  #dropArea:hover::before, #dropArea.dragover::before {
    opacity: 1;
  }

  #dropArea i {
    font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  #fileInput {
    display: none;
  }

  .file-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: var(--surface-secondary);
    padding: 1rem 1.25rem;
    border-radius: 8px;
    margin-top: 0.75rem;
    border: 1px solid var(--border-color);
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .file-name {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.95rem;
    font-weight: 500;
    flex: 1;
    min-width: 0; /* Important for text truncation */
  }

  .file-name span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 250px; /* Adjust based on your layout */
  }

  .file-size {
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-family: 'JetBrains Mono', monospace;
    flex-shrink: 0;
    margin-left: 0.5rem;
  }

  .remove-file {
    background: none;
    border: none;
    color: var(--error-color);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: var(--transition);
    flex-shrink: 0;
  }

  .remove-file:hover {
    background-color: rgba(248, 81, 73, 0.1);
  }

  button {
    padding: 0.875rem 1.5rem;
    border: none;
    border-radius: 8px;
    background-color: var(--primary-color);
    color: white;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    position: relative;
    overflow: hidden;
  }

  button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  button:hover::before {
    left: 100%;
  }

  button:hover:not(:disabled) {
    background-color: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(56, 139, 253, 0.3);
  }

  button:active:not(:disabled) {
    transform: translateY(0);
  }

  button:disabled {
    background-color: var(--surface-tertiary);
    cursor: not-allowed;
    opacity: 0.6;
  }

  #progressContainer {
    width: 100%;
    height: 8px;
    background-color: var(--surface-secondary);
    border-radius: 4px;
    overflow: hidden;
    display: none;
    margin-top: 0.5rem;
  }

  #progressBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
    border-radius: 4px;
    transition: width 0.3s ease;
    position: relative;
  }

  #progressBar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.3),
      transparent
    );
    transform: translateX(-100%);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    100% { transform: translateX(100%); }
  }

  #result, #error {
    margin-top: 2rem;
    padding: 1.25rem;
    border-radius: 8px;
    display: none;
    word-wrap: break-word;
    animation: slideUp 0.3s ease-out;
  }

  #result {
    border: 1px solid var(--success-color);
    background-color: rgba(63, 185, 80, 0.1);
  }

  #result h3 {
    color: var(--success-color);
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 600;
  }

  #result a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 500;
    word-break: break-all;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.95rem;
    transition: var(--transition);
  }

  #result a:hover {
    text-decoration: underline;
  }

  #result button {
    margin-top: 1rem;
    background-color: var(--success-color);
    color: white;
  }
  
  #result p {
      margin-bottom: 0.75rem;
  }

  #error {
    border: 1px solid var(--error-color);
    background-color: rgba(248, 81, 73, 0.1);
    color: var(--error-color);
  }

  #toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    opacity: 0;
    transform: translateX(100%);
    transition: var(--transition);
    z-index: 1000;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  #toast.show {
    opacity: 1;
    transform: translateX(0);
  }

  #toast.success { background-color: var(--success-color); }
  #toast.error { background-color: var(--error-color); }

  .stats-container {
    background-color: var(--surface-color);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    margin-bottom: 1.5rem;
    transition: var(--transition);
  }

  .stats-container:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow);
  }

  .stats-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .stat-item {
    background-color: var(--surface-secondary);
    padding: 1.25rem;
    border-radius: 8px;
    transition: var(--transition);
    border: 1px solid var(--border-color);
  }

  .stat-item:hover {
    transform: translateY(-2px);
    border-color: var(--primary-color);
  }

  .stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
  }

  .stat-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
  }

  .history-container {
    background-color: var(--surface-color);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    transition: var(--transition);
  }

  .history-container:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow);
  }

  .history-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .history-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .history-item {
    background-color: var(--surface-secondary);
    padding: 1rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: var(--transition);
    border: 1px solid var(--border-color);
  }

  .history-item:hover {
    transform: translateX(3px);
    border-color: var(--primary-color);
  }

  .history-file {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.95rem;
    flex: 1;
    min-width: 0; /* Important for text truncation */
  }

  .history-file a {
    color: var(--text-color);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 180px; /* Adjust based on your layout */
  }

  .history-file a:hover {
    color: var(--primary-color);
  }

  .history-date {
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-family: 'JetBrains Mono', monospace;
    flex-shrink: 0;
    margin-left: 0.5rem;
  }

  .loading-spinner {
    display: inline-block;
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .clear-history-btn {
    background-color: var(--surface-secondary);
    color: var(--text-secondary);
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    margin-top: 0.75rem;
    border: 1px solid var(--border-color);
  }

  .clear-history-btn:hover {
    background-color: var(--error-color);
    color: white;
    border-color: var(--error-color);
  }

  .header-actions {
    display: flex;
    gap: 0.5rem;
  }

  .header-actions button {
    background-color: var(--surface-secondary);
    color: var(--text-color);
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid var(--border-color);
  }

  .header-actions button:hover {
    background-color: var(--surface-tertiary);
    color: var(--primary-color);
  }

  /* Tooltip for full filename */
  .file-tooltip {
    position: relative;
  }

  .file-tooltip:hover::after {
    content: attr(data-fullname);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--surface-tertiary);
    color: var(--text-color);
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    font-size: 0.85rem;
    white-space: nowrap;
    z-index: 1000;
    box-shadow: var(--shadow);
    max-width: 300px;
    word-wrap: break-word;
    white-space: normal;
    margin-bottom: 0.5rem;
  }

  @media (max-width: 992px) {
    .app-container {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
      display: block;
    }
  }

  @media (max-width: 600px) {
    .container {
      padding: 1.5rem;
    }
    
    h2 {
      font-size: 1.5rem;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .version-selector {
      flex-direction: column;
    }

    .file-name span {
      max-width: 150px;
    }

    .history-file a {
      max-width: 120px;
    }
  }
</style>
</head>
<body>
<canvas id="particle-canvas" aria-hidden="true"></canvas>
<div class="app-container">
  <div class="main-content">
    <div class="container" role="main">
      <div class="header">
        <div class="logo">
          <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i>
          <h2>CDN-YUDZ</h2>
        </div>
        <div class="header-actions">
          <button type="button" id="themeToggle" aria-label="Toggle theme">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      </div>
      <p class="subtitle">Upload file Anda dengan cepat dan aman</p>
      
      <div class="tabs">
        <div class="tab active" data-tab="upload">Upload</div>
        <div class="tab" data-tab="history">Riwayat</div>
      </div>
      
      <div class="tab-content active" id="upload-tab">
        <form id="uploadForm" aria-describedby="descUpload">
          <div class="input-group">
            <label for="apiKeyInput">
              <i class="fas fa-key"></i> API Key
            </label>
            <input type="text" id="apiKeyInput" name="apikey" placeholder="Masukkan API Key Anda" required aria-required="true">
            <div class="api-info">
              <i class="fas fa-info-circle"></i>
              <span>Dapatkan API Key dengan login ke <a href="https://yydz.biz.id" target="_blank">yydz.biz.id</a> lalu pilih "Get Started"</span>
            </div>
          </div>

          <div class="input-group">
            <label>
              <i class="fas fa-code-branch"></i> Pilih Versi Upload
            </label>
            <div class="version-selector">
              <input type="radio" id="v1" name="version" value="v1" checked>
              <label for="v1">
                <i class="fas fa-infinity"></i>
                <span>v1 (Permanen)</span>
              </label>
              <input type="radio" id="v2" name="version" value="v2">
              <label for="v2">
                <i class="fas fa-clock"></i>
                <span>v2 (Kadaluarsa)</span>
              </label>
            </div>
          </div>

          <div class="input-group">
            <label id="dropArea" for="fileInput" tabindex="0" role="button" aria-label="Drag dan drop file ke sini atau klik untuk memilih file">
              <i class="fas fa-cloud-arrow-up"></i>
              <p id="descUpload">Drag & Drop file ke sini atau klik untuk memilih</p>
              <input type="file" id="fileInput" name="file" accept="*/*" required aria-required="true" />
            </label>
            <div id="fileInfo" class="file-info" style="display: none;">
              <div class="file-name">
                <i class="fas fa-file"></i>
                <span id="fileName" class="file-tooltip"></span>
              </div>
              <div class="file-size" id="fileSize"></div>
              <button type="button" id="removeFile" class="remove-file" aria-label="Remove file">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <button type="submit" id="uploadBtn" disabled aria-disabled="true">
            <i class="fas fa-upload"></i> <span>Upload File</span>
          </button>
          
          <div id="progressContainer" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Upload progress">
            <div id="progressBar"></div>
          </div>
        </form>

        <div id="result" role="alert" aria-live="polite">
          <h3><i class="fas fa-check-circle"></i> Upload Berhasil!</h3>
          <p>Link File:</p>
          <a id="resultLink" href="#" target="_blank"></a>
          <p id="expiryInfo"></p>
          <button id="copyBtn"><i class="fas fa-copy"></i> Salin Link</button>
        </div>
        
        <div id="error" role="alert" aria-live="assertive"></div>
      </div>
      
      <div class="tab-content" id="history-tab">
        <div class="history-list">
          <p style="text-align: center; color: var(--text-secondary); padding: 2rem 0;">Belum ada riwayat upload</p>
        </div>
        <button id="clearHistoryBtn" class="clear-history-btn">
          <i class="fas fa-trash"></i> Hapus Riwayat
        </button>
      </div>
    </div>
  </div>
  
  <div class="sidebar">
    <div class="stats-container">
      <div class="stats-title">
        <i class="fas fa-chart-bar"></i>
        Statistik Upload
      </div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="totalUploads">0</div>
          <div class="stat-label">Total Upload</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalSize">0 MB</div>
          <div class="stat-label">Total Ukuran</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="todayUploads">0</div>
          <div class="stat-label">Upload Hari Ini</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="storageUsed">0%</div>
          <div class="stat-label">Penyimpanan</div>
        </div>
      </div>
    </div>
    
    <div class="history-container">
      <div class="history-title">
        <i class="fas fa-history"></i>
        Upload Terbaru
      </div>
      <div class="history-list">
        <p style="text-align: center; color: var(--text-secondary); padding: 1rem 0;">Belum ada riwayat upload</p>
      </div>
    </div>
  </div>
</div>

<div id="toast" role="alert" aria-live="polite" aria-atomic="true"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- ELEMENT SELECTION ---
  const form = document.getElementById('uploadForm');
  const fileInput = document.getElementById('fileInput');
  const apiKeyInput = document.getElementById('apiKeyInput');
  const dropArea = document.getElementById('dropArea');
  const uploadBtn = document.getElementById('uploadBtn');
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progressBar');
  const resultDiv = document.getElementById('result');
  const resultLink = document.getElementById('resultLink');
  const expiryInfo = document.getElementById('expiryInfo');
  const copyBtn = document.getElementById('copyBtn');
  const errorDiv = document.getElementById('error');
  const toast = document.getElementById('toast');
  const fileInfo = document.getElementById('fileInfo');
  const fileName = document.getElementById('fileName');
  const fileSize = document.getElementById('fileSize');
  const removeFileBtn = document.getElementById('removeFile');
  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  
  // --- LOCALSTORAGE INITIALIZATION ---
  // Initialize localStorage if not exists
  if (!localStorage.getItem('uploadStats')) {
    localStorage.setItem('uploadStats', JSON.stringify({
      totalUploads: 0,
      totalSize: 0,
      todayUploads: 0,
      lastUploadDate: new Date().toDateString(),
      storageUsed: 0
    }));
  }
  
  if (!localStorage.getItem('uploadHistory')) {
    localStorage.setItem('uploadHistory', JSON.stringify([]));
  }
  
  // --- PARTICLE CANVAS ---
  const canvas = document.getElementById('particle-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  let particlesArray = [];
  let connectionDistance = 150;
  let mousePosition = { x: null, y: null };

  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 2 + 0.5;
      this.speedX = Math.random() * 0.5 - 0.25;
      this.speedY = Math.random() * 0.5 - 0.25;
      this.opacity = Math.random() * 0.5 + 0.2;
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      
      // Mouse interaction
      if (mousePosition.x != null) {
        let dx = mousePosition.x - this.x;
        let dy = mousePosition.y - this.y;
        let distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance < 100) {
          const forceDirectionX = dx / distance;
          const forceDirectionY = dy / distance;
          const maxDistance = 100;
          const force = (maxDistance - distance) / maxDistance;
          const directionX = forceDirectionX * force * 2;
          const directionY = forceDirectionY * force * 2;
          
          this.x -= directionX;
          this.y -= directionY;
        }
      }
      
      if (this.x > canvas.width) this.x = 0;
      if (this.x < 0) this.x = canvas.width;
      if (this.y > canvas.height) this.y = 0;
      if (this.y < 0) this.y = canvas.height;
    }
    draw() {
      ctx.fillStyle = `rgba(56, 139, 253, ${this.opacity})`;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function initParticles() {
    particlesArray = [];
    const numberOfParticles = Math.min(50, Math.floor((canvas.width * canvas.height) / 15000));
    for (let i = 0; i < numberOfParticles; i++) {
      particlesArray.push(new Particle());
    }
  }
  
  function connectParticles() {
    for (let a = 0; a < particlesArray.length; a++) {
      for (let b = a; b < particlesArray.length; b++) {
        let dx = particlesArray[a].x - particlesArray[b].x;
        let dy = particlesArray[a].y - particlesArray[b].y;
        let distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance < connectionDistance) {
          let opacity = 1 - (distance / connectionDistance);
          ctx.strokeStyle = `rgba(56, 139, 253, ${opacity * 0.2})`;
          ctx.lineWidth = 0.5;
          ctx.beginPath();
          ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
          ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
          ctx.stroke();
        }
      }
    }
  }
  
  function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particlesArray.forEach(particle => {
      particle.update();
      particle.draw();
    });
    connectParticles();
    requestAnimationFrame(animateParticles);
  }
  
  // Mouse position tracking
  window.addEventListener('mousemove', (event) => {
    mousePosition.x = event.x;
    mousePosition.y = event.y;
  });
  
  window.addEventListener('mouseout', () => {
    mousePosition.x = null;
    mousePosition.y = null;
  });
  
  initParticles();
  animateParticles();

  window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    initParticles();
  });

  // --- HELPER FUNCTIONS ---
  const showToast = (message, type) => {
    toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`;
    toast.className = type;
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => toast.classList.remove('show'), 3000);
  };

  const updateButtonState = () => {
    if (fileInput.files.length > 0 && apiKeyInput.value.trim() !== '') {
      uploadBtn.disabled = false;
      uploadBtn.setAttribute('aria-disabled', 'false');
    } else {
      uploadBtn.disabled = true;
      uploadBtn.setAttribute('aria-disabled', 'true');
    }
  };

  const formatFileSize = (bytes) => {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  };

  const truncateFilename = (filename, maxLength = 30) => {
    if (filename.length <= maxLength) return filename;
    
    const extension = filename.substring(filename.lastIndexOf('.'));
    const nameWithoutExt = filename.substring(0, filename.lastIndexOf('.'));
    
    if (nameWithoutExt.length <= maxLength - extension.length - 3) {
      return filename;
    }
    
    const truncatedName = nameWithoutExt.substring(0, maxLength - extension.length - 3);
    return truncatedName + '...' + extension;
  };

  // --- LOCALSTORAGE FUNCTIONS ---
  const getStats = () => {
    return JSON.parse(localStorage.getItem('uploadStats'));
  };
  
  const updateStats = (fileSize) => {
    const stats = getStats();
    const today = new Date().toDateString();
    
    // Reset today's count if it's a new day
    if (stats.lastUploadDate !== today) {
      stats.todayUploads = 0;
      stats.lastUploadDate = today;
    }
    
    stats.totalUploads += 1;
    stats.totalSize += fileSize;
    stats.todayUploads += 1;
    
    // Calculate storage used (assuming 5GB limit)
    const maxStorage = 5 * 1024 * 1024 * 1024; // 5GB in bytes
    stats.storageUsed = Math.round((stats.totalSize / maxStorage) * 100);
    
    localStorage.setItem('uploadStats', JSON.stringify(stats));
    renderStats();
  };
  
  const renderStats = () => {
    const stats = getStats();
    
    // Animate the stats
    animateValue('totalUploads', parseInt(document.getElementById('totalUploads').textContent), stats.totalUploads, 500);
    animateValue('todayUploads', parseInt(document.getElementById('todayUploads').textContent), stats.todayUploads, 500);
    animateValue('storageUsed', parseInt(document.getElementById('storageUsed').textContent), stats.storageUsed, 500);
    
    // Update total size with proper formatting
    document.getElementById('totalSize').textContent = formatFileSize(stats.totalSize);
  };
  
  const animateValue = (id, start, end, duration) => {
    const element = document.getElementById(id);
    const range = end - start;
    const increment = range / (duration / 16);
    let current = start;
    
    const timer = setInterval(() => {
      current += increment;
      if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
        element.textContent = end;
        clearInterval(timer);
      } else {
        element.textContent = Math.round(current);
      }
    }, 16);
  };
  
  const getHistory = () => {
    return JSON.parse(localStorage.getItem('uploadHistory'));
  };
  
  const addToHistory = (fileName, fileUrl, fileSize, version) => {
    const history = getHistory();
    const date = new Date().toLocaleString('id-ID', { 
      day: 'numeric', 
      month: 'short', 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    
    const newEntry = {
      id: Date.now(),
      fileName,
      fileUrl,
      fileSize,
      version,
      date
    };
    
    history.unshift(newEntry);
    
    // Limit history to 50 items
    if (history.length > 50) {
      history.pop();
    }
    
    localStorage.setItem('uploadHistory', JSON.stringify(history));
    renderHistory();
  };
  
  const renderHistory = () => {
    const history = getHistory();
    const historyList = document.querySelector('#history-tab .history-list');
    const sidebarHistory = document.querySelector('.sidebar .history-list');
    
    // Clear existing content
    historyList.innerHTML = '';
    sidebarHistory.innerHTML = '';
    
    if (history.length === 0) {
      historyList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem 0;">Belum ada riwayat upload</p>';
      sidebarHistory.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 1rem 0;">Belum ada riwayat upload</p>';
      return;
    }
    
    // Render history items
    history.forEach((item, index) => {
      const historyItem = document.createElement('div');
      historyItem.className = 'history-item';
      
      const truncatedName = truncateFilename(item.fileName, 25);
      
      historyItem.innerHTML = `
        <div class="history-file">
          <i class="fas fa-file"></i>
          <a href="${item.fileUrl}" target="_blank" class="file-tooltip" data-fullname="${item.fileName}">${truncatedName}</a>
        </div>
        <div class="history-date">${item.date}</div>
      `;
      
      // Add to main history tab
      historyList.appendChild(historyItem.cloneNode(true));
      
      // Add to sidebar history (limit to 5)
      if (index < 5) {
        const sidebarItem = historyItem.cloneNode(true);
        const sidebarLink = sidebarItem.querySelector('a');
        sidebarLink.textContent = truncateFilename(item.fileName, 18);
        sidebarHistory.appendChild(sidebarItem);
      }
    });
  };
  
  const clearHistory = () => {
    if (confirm('Apakah Anda yakin ingin menghapus semua riwayat upload?')) {
      localStorage.setItem('uploadHistory', JSON.stringify([]));
      renderHistory();
      showToast('Riwayat upload telah dihapus', 'success');
    }
  };
  
  // --- TAB FUNCTIONALITY ---
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const tabId = tab.getAttribute('data-tab');
      
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(tc => tc.classList.remove('active'));
      
      tab.classList.add('active');
      document.getElementById(`${tabId}-tab`).classList.add('active');
    });
  });

  // --- EVENT LISTENERS FOR FILE & API KEY ---
  apiKeyInput.addEventListener('input', updateButtonState);
  
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false);
    document.body.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.add('dragover'), false);
  });

  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.remove('dragover'), false);
  });

  dropArea.addEventListener('drop', (e) => {
    const dt = e.dataTransfer;
    const files = dt.files;
    fileInput.files = files;
    updateButtonState();
    showFileInfo(files[0]);
  }, false);

  fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
      showFileInfo(fileInput.files[0]);
    } else {
      hideFileInfo();
    }
    updateButtonState();
  });

  removeFileBtn.addEventListener('click', () => {
    fileInput.value = '';
    hideFileInfo();
    updateButtonState();
  });

  clearHistoryBtn.addEventListener('click', clearHistory);

  function showFileInfo(file) {
    const fullName = file.name;
    const truncatedName = truncateFilename(fullName, 30);
    
    fileName.textContent = truncatedName;
    fileName.setAttribute('data-fullname', fullName);
    fileSize.textContent = formatFileSize(file.size);
    fileInfo.style.display = 'flex';
    document.getElementById('descUpload').textContent = 'Klik atau drag & drop untuk mengganti file';
  }

  function hideFileInfo() {
    fileInfo.style.display = 'none';
    document.getElementById('descUpload').textContent = 'Drag & Drop file ke sini atau klik untuk memilih';
  }

  // --- FORM SUBMISSION & UPLOAD LOGIC ---
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const file = fileInput.files[0];
    const apiKey = apiKeyInput.value.trim();
    const selectedVersion = document.querySelector('input[name="version"]:checked').value;

    if (!file || !apiKey) {
      showError('Mohon pilih file dan masukkan API Key.');
      return;
    }

    handleUpload(file, apiKey, selectedVersion);
  });

  const handleUpload = (file, apiKey, version) => {
    const formData = new FormData();
    formData.append('file', file);
    
    // Reset UI
    resultDiv.style.display = 'none';
    errorDiv.style.display = 'none';
    progressContainer.style.display = 'block';
    progressBar.style.width = '0%';
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<span class="loading-spinner"></span> <span>Mengunggah...</span>';

    const xhr = new XMLHttpRequest();
    
    // URL API sekarang dinamis berdasarkan versi yang dipilih
    const url = `/api/${version}/upload?apikey=${encodeURIComponent(apiKey)}`;

    xhr.open('POST', url, true);

    xhr.upload.onprogress = (e) => {
      if (e.lengthComputable) {
        const percentComplete = (e.loaded / e.total) * 100;
        progressBar.style.width = `${percentComplete}%`;
        progressContainer.setAttribute('aria-valuenow', Math.round(percentComplete));
      }
    };

    xhr.onload = () => {
      uploadBtn.disabled = false;
      uploadBtn.innerHTML = '<i class="fas fa-upload"></i> <span>Upload File</span>';
      progressContainer.style.display = 'none';

      if (xhr.status === 200) {
        const response = JSON.parse(xhr.responseText);
        if (response.success) {
          showSuccess(response.result);
          updateStats(file.size);
          addToHistory(file.name, response.result.url, file.size, version);
        } else {
          showError(response.message || 'Terjadi kesalahan yang tidak diketahui.');
        }
      } else {
        let errorMessage = `Gagal mengunggah file. Status: ${xhr.status}`;
        try {
          const errorResponse = JSON.parse(xhr.responseText);
          errorMessage = errorResponse.message || errorMessage;
        } catch (e) {
          // Ignore JSON parse error
        }
        showError(errorMessage);
      }
    };

    xhr.onerror = () => {
      uploadBtn.disabled = false;
      uploadBtn.innerHTML = '<i class="fas fa-upload"></i> <span>Upload File</span>';
      progressContainer.style.display = 'none';
      showError('Jaringan error. Silakan coba lagi.');
    };

    xhr.send(formData);
  };

  const showSuccess = (result) => {
    resultLink.href = result.url;
    resultLink.textContent = result.url;
    resultDiv.style.display = 'block';

    // Tampilkan info kedaluwarsa jika ada (untuk v2)
    if (result.expired) {
      const expiryDate = new Date(result.expired).toLocaleString('id-ID');
      expiryInfo.textContent = `Link kadaluwarsa pada: ${expiryDate}`;
      expiryInfo.style.display = 'block';
    } else {
      expiryInfo.style.display = 'none';
    }

    showToast('File berhasil diunggah!', 'success');
  };

  const showError = (message) => {
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    showToast(message, 'error');
  };

  // --- COPY TO CLIPBOARD ---
  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(resultLink.href).then(() => {
      showToast('Link berhasil disalin!', 'success');
    }).catch(err => {
      console.error('Gagal menyalin link: ', err);
      showToast('Gagal menyalin link.', 'error');
    });
  });

  // --- INITIALIZE STATS AND HISTORY ---
  renderStats();
  renderHistory();
});
</script>
</body>
</html>